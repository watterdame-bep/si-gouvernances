# ============================================================================
# REDIS CONFIGURATION PRODUCTION - SI-GOUVERNANCE
# ============================================================================

# Bind à toutes les interfaces (Docker network)
bind 0.0.0.0

# Port
port 6379

# Protection par mot de passe (optionnel, à activer si nécessaire)
# requirepass your_redis_password_here

# ============================================================================
# PERSISTENCE
# ============================================================================
# AOF (Append Only File) pour durabilité maximale
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# RDB Snapshots (backup)
save 900 1
save 300 10
save 60 10000

# ============================================================================
# MÉMOIRE
# ============================================================================
maxmemory 512mb
maxmemory-policy allkeys-lru

# ============================================================================
# PERFORMANCE
# ============================================================================
# Désactiver les commandes dangereuses
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""

# Timeout des connexions inactives
timeout 300

# TCP keepalive
tcp-keepalive 60

# ============================================================================
# LOGS
# ============================================================================
loglevel notice
logfile ""

# ============================================================================
# SÉCURITÉ
# ============================================================================
# Désactiver les commandes dangereuses en production
# rename-command SHUTDOWN ""
# rename-command DEBUG ""

# Nombre maximum de clients
maxclients 10000

# ============================================================================
# OPTIMISATIONS
# ============================================================================
# Désactiver THP (Transparent Huge Pages)
# À faire au niveau de l'hôte: echo never > /sys/kernel/mm/transparent_hugepage/enabled

# Overcommit memory
# À faire au niveau de l'hôte: sysctl vm.overcommit_memory=1
