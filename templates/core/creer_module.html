{% extends 'base.html' %}

{% block title %}Cr√©er un Module - {{ projet.nom }} - SI-Gouvernance JCM{% endblock %}
{% block page_title %}Cr√©er un Module - {{ projet.nom }}{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen p-2 md:p-4">
    <div class="max-w-4xl mx-auto space-y-4">
        
        <!-- Header -->
        <div class="bg-white rounded-lg p-4 shadow-md border border-white/20">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-md">
                        <span class="text-white font-bold text-sm">üß©</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Cr√©er un Module</h1>
                        <p class="text-sm text-gray-600">{{ projet.nom }} - Nouveau module fonctionnel</p>
                    </div>
                </div>
                <a href="{% url 'gestion_modules' projet.id %}" class="inline-flex items-center px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium shadow-md transition-all duration-300 text-sm">
                    <span class="mr-2">‚Üê</span>Retour aux modules
                </a>
            </div>
        </div>

        <!-- Informations sur l'√©tape courante -->
        {% if etape_courante %}
        <div class="bg-white rounded-lg p-4 shadow-md border border-white/20">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center shadow-md">
                    <span class="text-white text-sm">{{ etape_courante.type_etape.icone_emoji }}</span>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">√âtape courante: {{ etape_courante.type_etape.get_nom_display }}</h3>
                    <p class="text-sm text-gray-600">{{ etape_courante.type_etape.description }}</p>
                </div>
            </div>
            
            {% if peut_creer_librement %}
            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                <div class="flex items-center">
                    <span class="text-green-500 mr-2">‚úÖ</span>
                    <p class="text-sm text-green-800 font-medium">Vous pouvez cr√©er ce module librement dans cette √©tape.</p>
                </div>
            </div>
            {% else %}
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <div class="flex items-center">
                    <span class="text-orange-500 mr-2">‚ö†Ô∏è</span>
                    <p class="text-sm text-orange-800 font-medium">Cr√©ation tardive - Une justification sera requise et trac√©e dans l'audit.</p>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Formulaire de cr√©ation -->
        <div class="bg-white rounded-lg p-6 shadow-md border border-white/20">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Informations de base -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-900 border-b border-gray-200 pb-2">Informations du module</h3>
                    
                    <!-- Nom du module -->
                    <div>
                        <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">
                            Nom du module <span class="text-red-500">*</span>
                        </label>
                        <input type="text" 
                               id="nom" 
                               name="nom" 
                               required 
                               maxlength="100"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300"
                               placeholder="Ex: Authentification, Gestion des stocks, Rapports..."
                               value="{{ request.POST.nom|default:'' }}">
                        <p class="mt-1 text-xs text-gray-500">Nom clair et descriptif du module fonctionnel</p>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Description <span class="text-red-500">*</span>
                        </label>
                        <textarea id="description" 
                                  name="description" 
                                  required 
                                  rows="4"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300"
                                  placeholder="D√©crivez les fonctionnalit√©s et objectifs de ce module...">{{ request.POST.description|default:'' }}</textarea>
                        <p class="mt-1 text-xs text-gray-500">Description d√©taill√©e des fonctionnalit√©s du module</p>
                    </div>
                </div>

                <!-- Personnalisation visuelle -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-gray-900 border-b border-gray-200 pb-2">Personnalisation</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Couleur -->
                        <div>
                            <label for="couleur" class="block text-sm font-medium text-gray-700 mb-2">
                                Couleur du module
                            </label>
                            <div class="flex items-center space-x-3">
                                <input type="color" 
                                       id="couleur" 
                                       name="couleur" 
                                       value="{{ request.POST.couleur|default:'#10B981' }}"
                                       class="w-12 h-12 border border-gray-300 rounded-lg cursor-pointer">
                                <div class="flex-1">
                                    <input type="text" 
                                           id="couleur_text" 
                                           value="{{ request.POST.couleur|default:'#10B981' }}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm"
                                           readonly>
                                </div>
                            </div>
                            <p class="mt-1 text-xs text-gray-500">Couleur d'identification du module</p>
                        </div>
                        
                        <!-- Ic√¥ne emoji -->
                        <div>
                            <label for="icone_emoji" class="block text-sm font-medium text-gray-700 mb-2">
                                Ic√¥ne (emoji)
                            </label>
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl" id="preview_emoji">
                                    {{ request.POST.icone_emoji|default:'üß©' }}
                                </div>
                                <input type="text" 
                                       id="icone_emoji" 
                                       name="icone_emoji" 
                                       value="{{ request.POST.icone_emoji|default:'üß©' }}"
                                       maxlength="10"
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-center"
                                       placeholder="üß©">
                            </div>
                            <p class="mt-1 text-xs text-gray-500">Emoji repr√©sentant le module</p>
                        </div>
                    </div>
                </div>

                <!-- Justification si cr√©ation tardive -->
                {% if not peut_creer_librement %}
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-orange-800 border-b border-orange-200 pb-2">
                        <span class="mr-2">‚ö†Ô∏è</span>Justification de cr√©ation tardive
                    </h3>
                    
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <p class="text-sm text-orange-800 mb-3">
                            Ce module est cr√©√© apr√®s la phase de conception. Veuillez justifier cette cr√©ation tardive pour la tra√ßabilit√©.
                        </p>
                        
                        <label for="justification" class="block text-sm font-medium text-orange-700 mb-2">
                            Justification <span class="text-red-500">*</span>
                        </label>
                        <textarea id="justification" 
                                  name="justification" 
                                  required 
                                  rows="3"
                                  class="w-full px-4 py-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 bg-white"
                                  placeholder="Expliquez pourquoi ce module n'a pas √©t√© d√©fini en phase de conception...">{{ request.POST.justification|default:'' }}</textarea>
                        <p class="mt-1 text-xs text-orange-600">Cette justification sera enregistr√©e dans l'audit du projet</p>
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <a href="{% url 'gestion_modules' projet.id %}" class="inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium shadow-md transition-all duration-300">
                        <span class="mr-2">‚Üê</span>Annuler
                    </a>
                    
                    <button type="submit" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg font-medium shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                        <span class="mr-2">üß©</span>Cr√©er le module
                    </button>
                </div>
            </form>
        </div>

        <!-- Aide -->
        <div class="bg-white rounded-lg p-6 shadow-md border border-white/20">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
                    <span class="text-white text-sm">üí°</span>
                </div>
                <h3 class="text-lg font-bold text-gray-900">Conseils pour cr√©er un module</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-3">
                    <h4 class="font-medium text-gray-900">Nommage</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>‚Ä¢ Utilisez des noms clairs et fonctionnels</li>
                        <li>‚Ä¢ √âvitez les termes techniques trop sp√©cifiques</li>
                        <li>‚Ä¢ Pensez √† l'utilisateur final</li>
                    </ul>
                </div>
                <div class="space-y-3">
                    <h4 class="font-medium text-gray-900">Organisation</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>‚Ä¢ Un module = une fonctionnalit√© principale</li>
                        <li>‚Ä¢ Regroupez les t√¢ches li√©es</li>
                        <li>‚Ä¢ Pr√©voyez l'√©volutivit√©</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts JavaScript -->
<script>
// Synchronisation couleur
document.getElementById('couleur').addEventListener('input', function() {
    document.getElementById('couleur_text').value = this.value;
});

// Pr√©visualisation emoji
document.getElementById('icone_emoji').addEventListener('input', function() {
    document.getElementById('preview_emoji').textContent = this.value || 'üß©';
});
</script>
{% endblock %}