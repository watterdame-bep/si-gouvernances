{% extends 'base.html' %}

{% block title %}Nouveau Module - {{ projet.nom }}{% endblock %}
{% block page_title %}Nouveau Module{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-2xl mx-auto space-y-6">
        
        <!-- Header compact -->
        <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cube text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900">Nouveau Module</h1>
                        <p class="text-sm text-gray-600">{{ projet.nom }}</p>
                    </div>
                </div>
                <a href="{% url 'gestion_modules' projet.id %}" 
                   class="inline-flex items-center px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm font-medium transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Retour
                </a>
            </div>
        </div>

        <!-- Formulaire moderne -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <form method="post" class="p-6 space-y-6">
                {% csrf_token %}
                
                <!-- Informations de base -->
                <div class="space-y-4">
                    <!-- Nom -->
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag text-blue-600 mr-2"></i>
                            Nom du module
                        </label>
                        <input type="text" 
                               name="nom" 
                               required 
                               maxlength="100"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Ex: Authentification, Gestion stocks..."
                               value="{{ request.POST.nom|default:'' }}">
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-align-left text-blue-600 mr-2"></i>
                            Description
                        </label>
                        <textarea name="description" 
                                  required 
                                  rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="D√©crivez les fonctionnalit√©s principales...">{{ request.POST.description|default:'' }}</textarea>
                    </div>
                </div>

                <!-- √âquipe -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="flex items-center text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-users text-green-600 mr-2"></i>
                        √âquipe
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Responsable -->
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-crown text-yellow-500 mr-2"></i>
                                Responsable
                            </label>
                            <select name="responsable" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Choisir...</option>
                                {% for membre in equipe_projet %}
                                <option value="{{ membre.id }}" {% if membre.id == user.id %}selected{% endif %}>
                                    {{ membre.get_full_name }}
                                    {% if membre.id == user.id %} (Vous){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- Contributeurs -->
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user-friends text-green-500 mr-2"></i>
                                Contributeurs
                            </label>
                            <select name="contributeurs" 
                                    multiple
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                {% for membre in equipe_projet %}
                                <option value="{{ membre.id }}">{{ membre.get_full_name }}</option>
                                {% endfor %}
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Ctrl+clic pour s√©lectionner plusieurs</p>
                        </div>
                    </div>
                </div>

                <!-- Apparence -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="flex items-center text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-palette text-purple-600 mr-2"></i>
                        Apparence
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Couleur -->
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-circle text-purple-500 mr-2"></i>
                                Couleur
                            </label>
                            <div class="flex items-center space-x-3">
                                <input type="color" 
                                       name="couleur" 
                                       value="{{ request.POST.couleur|default:'#3B82F6' }}"
                                       class="w-12 h-12 border border-gray-300 rounded-lg cursor-pointer">
                                <span class="text-sm text-gray-600">Couleur d'identification</span>
                            </div>
                        </div>
                        
                        <!-- Ic√¥ne -->
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-icons text-purple-500 mr-2"></i>
                                Ic√¥ne
                            </label>
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-xl" id="preview_emoji">
                                    {{ request.POST.icone_emoji|default:'üß©' }}
                                </div>
                                <input type="text" 
                                       name="icone_emoji" 
                                       value="{{ request.POST.icone_emoji|default:'üß©' }}"
                                       maxlength="2"
                                       class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center"
                                       placeholder="üß©">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Justification si n√©cessaire -->
                {% if not peut_creer_librement %}
                <div class="border-t border-gray-200 pt-6">
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <label class="flex items-center text-sm font-medium text-orange-800 mb-2">
                            <i class="fas fa-exclamation-triangle text-orange-600 mr-2"></i>
                            Justification requise
                        </label>
                        <textarea name="justification" 
                                  required 
                                  rows="3"
                                  class="w-full px-4 py-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white"
                                  placeholder="Pourquoi cr√©er ce module maintenant ?">{{ request.POST.justification|default:'' }}</textarea>
                        <p class="text-xs text-orange-600 mt-1">Cr√©ation hors phase de conception</p>
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <a href="{% url 'gestion_modules' projet.id %}" 
                       class="inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
                        <i class="fas fa-times mr-2"></i>Annuler
                    </a>
                    
                    <button type="submit" 
                            class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-sm">
                        <i class="fas fa-plus mr-2"></i>Cr√©er le module
                    </button>
                </div>
            </form>
        </div>

        <!-- Aide rapide -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-start space-x-3">
                <i class="fas fa-lightbulb text-blue-600 mt-0.5"></i>
                <div>
                    <h4 class="text-sm font-medium text-blue-900 mb-1">Conseils</h4>
                    <ul class="text-sm text-blue-800 space-y-1">
                        <li>‚Ä¢ Nom clair et fonctionnel</li>
                        <li>‚Ä¢ Un module = une fonctionnalit√© principale</li>
                        <li>‚Ä¢ Le responsable peut cr√©er et assigner des t√¢ches</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Pr√©visualisation emoji
document.querySelector('input[name="icone_emoji"]').addEventListener('input', function() {
    document.getElementById('preview_emoji').textContent = this.value || 'üß©';
});
</script>
{% endblock %}